<%= error_messages_for 'questionnaire' %>

<!--[form:questionnaire]-->
<table>
	<tr>
		<td valign="top"><label for="questionnaire_name">Name:</label>	</td>
		<td>
			<% if @questionnaire.type == "QuizQuestionnaire" and @questionnaire.name.nil? %>
				<%= text_field 'questionnaire', 'name', :value=>"#{session[:user].name}'s quiz"  %>
				<%= hidden_field 'questionnaire', 'max_question_score', :value=>4 %>
			<% else %>
				<%= text_field 'questionnaire', 'name' %>
			<% end %>
			<%= hidden_field 'questionnaire', 'id' %>
			<%= hidden_field 'questionnaire', 'type' %>
		</td>		
	</tr>
</table>
<table>
	<tr>
		<% if @questionnaire.type != "QuizQuestionnaire" %>
		<td>Min question score:</td>
		<td><%= text_field 'questionnaire', 'min_question_score', :size=> 1 %>&nbsp;&nbsp;</td>
		<td>Max question score:</td>
		<td><%= text_field 'questionnaire', 'max_question_score', :size=> 1 %>&nbsp;&nbsp;</td>
		<% end %>
		<td>Is this <%= @questionnaire.display_type %> private:</td> 
		<td><%= select(:questionnaire, :private, [ ['no', false], 
									 		['yes',  true]])%>
		</td>
		
	</tr>
</table>

<br/>

<table id="questions_table">
	<tr>
        <td colspan=2 style="padding-bottom: 5pt"><strong>Questions</strong>
		  <input style="margin-left: 50pt" type="button" value="Add" onclick="addQuestions()">
		  <%= select(:addQuestion, :type, Question::QUESTION_TYPES)%>
		  <input id="numQuestionsToAdd" type="text" value="1" size=1>
		  more question(s)</td>
		  <td>
		</td>
		<td colspan=2><input type="button" value="Delete selected questions" onclick="deleteQuestions()"></td>
	</tr>
	
	<% if @questionnaire.type == "QuizQuestionnaire" %>
	<tr>
		<td></td>
		<td>
					Quiz questions are specified in the following format:
					<ul>
						<li>Who's buried in Grant's tomb? {~Churchill =Grant ~Napoleon ~No one}</li>
					</ul>
					This follows the pattern of the simple multiple choice questions specified by the
					<a href="http://docs.moodle.org/en/GIFT#Multiple_choice">Moodle GIFT format</a>.
					Answers are enclosed in {}.  A ~ precedes incorrect answers, while an = precedes
					the correct answer.
		</td>
	</tr>
	<% end %>
	
	<tr>
		<td align=left width=30>Delete</td>
		<td align=center width=500>Question</td>
		<% if @questionnaire.type != "QuizQuestionnaire" %>
		<td align=center width=100>Scoring</td>
		<td align=left>Weight</td>
		<% end %>
	
	</tr>
		
	<% 	i = 1;
		for @question in @questionnaire.questions %>
	<tr>
		<td align=center><input type=checkbox id="question_chk<%= i %>"></td>
		<td><%= text_field "question[]", 'txt', :size=>70 %>
		<table>
			
			<!--the for loop below shows label for a question and saves bak to database-->
			<% 	for @labelT in @question.label %>
			<tr><td>
					label: <input value='<%= @labelT[1] %>' class='label_text' id='new_question_label' name='question[<%= i%>][label][<%= @labelT[0] %>]' size=10 type=text/>
			</td></tr>
			<% end %>
			
		</table>
		</td>			
		<% if @questionnaire.type != "QuizQuestionnaire" %>
			<td><%= select("question[]", :true_false, Question::GRADING_TYPES)%></td>
			<td><%= select("question[]", :weight, Question::WEIGHTS)%></td>
		<% end %>
	</tr>

	<% if @questionnaire.type == "QuizQuestionnaire" %>
	<% p = @question.parse %>
	<tr>
		<td></td>
		<td>
			<% if p.nil? %>
			WARNING: Improperly formatted question! <br />
			<% elsif p[:correct].length == 0 %>
			WARNING: Question has no correct answer! <br /> 
			<% end %>
		</td>
	</tr>
	<% end %>
	<% 	i += 1;
		 end %>
</table>
<BR/>
<!--[eoform:course]-->

