<script type="text/javascript">
num_questions = <%= [@questionnaire.questions.length,1].max %>;
<% a = 3 %>
function deleteQuestions(){
	var checkedObjArray = new Array();
	var deleteCount = 0;
	var tbl = document.getElementById("questions_table");
	var numChecks = 0;
	for(i=0; i<document.forms[0].elements.length; i++){
		if(document.forms[0].elements[i].type=="checkbox" &&
		   document.forms[0].elements[i].id.substring(0,12)=="question_chk"){
			numChecks++;
			if(document.forms[0].elements[i].checked==true){
				tbl.deleteRow(numChecks+1);
				numChecks = 0;
				deleteQuestions();
			}
		}
	}
}

function addQuestions(){
	numQuestionsToAdd = parseInt(document.getElementById("numQuestionsToAdd").value);
	for(i=0; i<numQuestionsToAdd; i++){
		addQuestion();
	}
}
	function addOptionToQuestion(me){
			var labelTable = me.parentNode.parentNode.parentNode.parentNode;
			var labelCount = parseInt(labelTable.getElementsByClassName('label_count')[0].innerHTML);
			labelTable.getElementsByClassName('label_count')[0].innerHTML = (labelCount+1);
			var myId = parseInt(labelTable.getElementsByClassName('my_id')[0].innerHTML);
			var labelRow = labelTable.insertRow(-1);
			column = document.createElement("td");
			column.innerHTML = "label: <input value="+myId+"_"+(labelCount+1)+" class='label_text' id=new_question_" + myId + "_label name=new_question[" + myId + "][label][" + (labelCount+1) +"] size=10 type=text/>";
			column.innerHTML += " <a href='javascript:;' onClick='deleteThisOption(this);'>remove option</a> ";
			labelRow.appendChild(column);
		
		}
		function deleteThisOption(me){
			var my_parent = me.parentNode.parentNode.parentNode;
			my_parent.removeChild(me.parentNode.parentNode);	
		
		}

function addQuestion(){
	typeQuestion = parseInt(document.getElementById("addQuestion_type").value);
	if (typeQuestion == 0)	{
		table = document.getElementById("questions_table");
		var row = table.insertRow(-1);
		
		id = num_questions;
		column = document.createElement("td");
		column.innerHTML = "<center><input type=checkbox id='question_chk" + num_questions + "'></center>";
		row.appendChild(column);
		
		column = document.createElement("td");
		column.innerHTML = "<input id=new_question_" + id + "_txt name=new_question[" + id + "][txt] size=70 type=text/>";
		row.appendChild(column);
		
		/* this is code that adds an additional field: since we are using text strings this is a good test case */
		column = document.createElement("td");
		column.innerHTML = "<input id=new_question_" + id + "_txt name=new_question[" + id + "][type] size=10 type=text/>";
		row.appendChild(column);
		column = document.createElement("td");
		column.innerHTML = "<input id=new_question_" + id + "_txt name=new_question[" + id + "][label][1] size=10 type=text/>";
		row.appendChild(column);
		column = document.createElement("td");
		column.innerHTML = "<input id=new_question_" + id + "_txt name=new_question[" + id + "][label][2] size=10 type=text/>";
		row.appendChild(column);
		/* this is code that adds stuff */
		
		column = document.createElement("td");
		gradingTypes = "<select id=question_" + id + "_true_false name=new_question[" + id + "][true_false]>";
		<% for type in Question::GRADING_TYPES %>
			<%= "gradingTypes += '<option value=" + type[1].to_s + ">" + type[0].to_s + "</option>';"%>
		<% end %>
		gradingTypes += "</select>"
		column.innerHTML = gradingTypes;
		row.appendChild(column);
		
		column = document.createElement("td");
		weights = "<select id=new_question_" + id + "_weight name=new_question[" + id + 		"][weight]>";
		<% for weight in Question::WEIGHTS %>
			<%= "weights += '<option value=" + weight[1].to_s + ">" + weight[0].to_s + "</option>';"%>
		<% end %>
		weights = weights + "</select>";
		column.innerHTML = weights;
		row.appendChild(column);
		num_questions = num_questions + 1;
	}
	
	
	if (typeQuestion == 1 || typeQuestion == 2)	{
		table = document.getElementById("questions_table");
		var row = table.insertRow(-1);
		
		id = num_questions;
		column = document.createElement("td");
		column.innerHTML = "<center><input type=checkbox id='question_chk" + num_questions + "'></center>";
		row.appendChild(column);
		/*
		column = document.createElement("td");
		column.innerHTML = "<div id=new_question" + id + ">";
		column.innerHTML += "<input id=new_question_" + id + "_txt name=new_question[" + id + "][txt] size=70 type=text/>";
		column.innerHTML += "<input value=" + typeQuestion + " id=new_question_" + id + "_type name=new_question[" + id + "][type] size=10 type=hidden />";
		column.innerHTML += "</div>";
		column.innerHTML += "<div id=new_question" + id + "_labels>";
		column.innerHTML += "<input id=new_question_" + id + "_label name=new_question[" + id + "][label][1] size=10 type=text/>";
		column.innerHTML += "</div>";
		row.appendChild(column);
		*/
		column = document.createElement("td");
		column.innerHTML = "<table id=new_question" + id + "></table>";
		row.appendChild(column);
		labelTable = document.getElementById("new_question" + id );
		var labelRow = labelTable.insertRow(-1);
		column = document.createElement("td");
		if(typeQuestion==1)		column.innerHTML = "Checkbox ";
		if(typeQuestion==2)		column.innerHTML = "Radiobuttons "; 
		column.innerHTML += "<input value='q1' id=new_question_" + id + "_txt name=new_question[" + id + "][txt] size=70 type=text />";
		column.innerHTML += "<span class='label_count' style='visibility:hidden;'>1</span>";
		column.innerHTML += "<span class='my_id' style='visibility:hidden;'>" + id + "</span>";
		column.innerHTML += "<input value=" + typeQuestion + " id=new_question_" + id + "_type name=new_question[" + id + "][type] size=10 type=hidden />";
		labelRow.appendChild(column);
		
		var labelRow = labelTable.insertRow(-1);
		column = document.createElement("td");
		column.innerHTML = " <a href='javascript:;' onClick='addOptionToQuestion(this);'>add option</a> ";
		labelRow.appendChild(column);
		
		var labelRow = labelTable.insertRow(-1);
		column = document.createElement("td");
		column.innerHTML = "label: <input value="+id+"_1"+" class='label_text' id=new_question_" + id + "_label name=new_question[" + id + "][label][1] size=10 type=text/>";
		labelRow.appendChild(column);
		
		
		
		
		
		column = document.createElement("td");
		gradingTypes = "<select id=question_" + id + "_true_false name=new_question[" + id + "][true_false]>";
		<% for type in Question::GRADING_TYPES %>
			<%= "gradingTypes += '<option value=" + type[1].to_s + ">" + type[0].to_s + "</option>';"%>
		<% end %>
		gradingTypes += "</select>"
		column.innerHTML = gradingTypes;
		row.appendChild(column);
		
		column = document.createElement("td");
		weights = "<select id=new_question_" + id + "_weight name=new_question[" + id + 		"][weight]>";
		<% for weight in Question::WEIGHTS %>
			<%= "weights += '<option value=" + weight[1].to_s + ">" + weight[0].to_s + "</option>';"%>
		<% end %>
		weights = weights + "</select>";
		column.innerHTML = weights;
		row.appendChild(column);
		num_questions = num_questions + 1;
	}
}
</script>