<% if session[:user].role.name == "Teaching Assistant"
      user_id = Ta.get_my_instructor(session[:user].id)
   else
      user_id = session[:user].id
   end %>

<script type="text/javascript">

num_jobs = 0;

function onChange(){
	count = document.getElementById("team_count1");
	hidden = document.getElementById("team_count2");
	document.poppedLayer3 = eval('document.getElementById("teammate_review")');
	var dropdownIndex = document.getElementById('teamselect').selectedIndex;
	var dropdownValue = document.getElementById('teamselect')[dropdownIndex].value;
	if(dropdownValue == "true"){
		count.style.display = "";
		hidden.style.display = "none";
		document.poppedLayer3.style.display = "";
		var rdolist = document.getElementsByName("radio_rotcond");
		if(rdolist[1].checked == false && rdolist[2].checked == false)
			rdolist[0].checked = true;
		rdolist[0].disabled = false;
		rdolist[1].disabled = false;
		rdolist[2].disabled = false;
		
	}else{
		count.style.display = "none";
		hidden.style.display  = "";
		document.poppedLayer3.style.display = "none";
		var rdolist = document.getElementsByName("radio_rotcond");
		rdolist[0].checked = true;
		rdolist[0].disabled = true;
		rdolist[1].disabled = true;
		rdolist[2].disabled = true;
		document.getElementsByName("max_num")[0].style.visibility = "hidden";
		document.getElementsByName("select_categories")[0].style.visibility = "hidden";
		document.getElementsByName("other_category")[0].style.visibility = "hidden";
	}
}

	function addJobs() {
	
		for (var x = 1; x <= document.getElementById("team_count").value; x++) {addJob();}
		
	}

	function addJob(){
	
		num_jobs ++;

		table = document.getElementById("teammate_review");

		var row = table.insertRow(-1);
		
		column = document.createElement("td");

		column.innerHTML = "<input name='job_title[" + num_jobs + "]' size='25' type='text' value='Job Name'>";

		row.appendChild(column);
	
		column = document.createElement("td");

		column.innerHTML = "<% selected = @assignment.questionnaires.find_by_type('TeammateReviewQuestionnaire') %><select style='width:500px' name='team_questionnaires[" + num_jobs + "]'><option value='0' <%if selected.nil?%>selected='yes'<%end%>>--None--</option><% TeammateReviewQuestionnaire.find(:all, :conditions => ['private = 0 or instructor_id = ?',user_id]).each{| questionnaire | %><option value='<%=questionnaire.id%>' <% if selected != nil and questionnaire.id == selected.id%>selected='yes'<%end%>><%=questionnaire.name %></option><% } %></select>";

		row.appendChild(column);

	}

function get_assignment_startdate() {
    //var start_date = document.getElementById("assignment_startdate");
    var staggered_label = document.getElementById("staggered_label");
    var days_between_chapters = document.getElementById("days_between_chapters");
    var dropdownIndex = document.getElementById('staggered_deadline').selectedIndex;
	var dropdownValue = document.getElementById('staggered_deadline')[dropdownIndex].value;
	if(dropdownValue == "true"){
		//start_date.style.display = "";
        staggered_label.style.display = "";
        days_between_chapters.style.display = "";
	}else{
		//start_date.style.display = "none";
        staggered_label.style.display = "none";
        days_between_chapters.style.display = "none";
	}
}
</script>

<% if flash[:notice] != nil and flash[:notice].strip != "" %>
<div class="flash_error">
	<%= flash[:notice] %>
</div>
<% end %>
<%= error_messages_for 'assignment' %>

<!--[form:assignment]-->
<table>

<tr>
<td><table>
<tr>
  <td><label for="assignment_name">Assignment name: </label></td>
  <td><%= text_field 'assignment', 'name'  %></td>
</tr>
<tr>
  <td><label for="assignment_directory" id="assgt_directory">Submission directory: </label></td>
  <td><%= text_field 'assignment', 'directory_path'%></td>
</tr>
<tr>
  <td height="50" valign="top"><label for="assignment_spec">URL of assignment description:</label></td>
  <td height="50" valign="top"><%= text_field 'assignment', 'spec_location'  %></td>
</tr>
<tr>  
</table></td>

<td>&nbsp;&nbsp;&nbsp;&nbsp;</td>

<td><table>
<tr>
  <td width="250"><label for="wiki_type">Wiki Type:</label></td>
  <td>
    <% if @wiki_types.length == 0 %>
      <em>There are currently no wiki assignment types defined</em>
      <br/>
      <br/>
    <% else %>
      <select name="assignment[wiki_type_id]" width="15%">
      <% @wiki_types.each do |wiki_type| %>
        <option style="width:75px" value="<%= wiki_type.id %>"
        <%= ' selected' if wiki_type.id == @assignment.wiki_type_id %> >
        <%= wiki_type.name %>
        </option>
      <% end %>
      </select>
    <% end %>
  </td>
</tr>
<tr>
  <!-- added for code review option -->
  <td><label for="codereview">Code Review assignment:</label></td>
  <td>
  		<select id="codereviewselect" name="assignment[codereview]">
  		 <option value=false style="width:75px">No</option>
         <option value=true style="width:75px" <% if @assignment.codereview %>SELECTED<%end%>>Yes</option>      
        </select>
  </td>  
</tr>
<tr>
  <td><label for="team_assignment">Team assignment:</label></td>
  <td>
  		<select id="teamselect" name="assignment[team_assignment]" onchange="onChange();">
  		 <option value=false style="width:75px">No</option>
         <option value=true style="width:75px" <% if @assignment.team_assignment %>SELECTED<%end%>>Yes</option>      
        </select>
  </td>  
</tr>

 <tr><td><label for="staggered">Staggered deadline?</label></td>

 <td>
  		<select id="staggered_deadline" name="assignment[staggered_deadline]" onchange="get_assignment_startdate();">
  		 <option value=false style="width:75px">No</option>
         <option value=true style="width:75px" <% if @assignment.staggered_deadline %>SELECTED<%end%>>Yes</option>
        </select>
  </td>

 </tr>

<tr id="team_count1" style="display:none">  
  <td valign="top" width="250" height="50"><label for="team_count">Maximum number of participants per team:</label></td>   
  <td valign="top"><%= text_field 'assignment', 'team_count', :size => 5, "onchange" => "addJobs();", "id"=>"team_count"%></td>  
  </td> 
</tr>

<tr id="team_count2">
  <td colspan="2" height="50">&nbsp;</td>
</tr> 
</table></td>
</tr>
</table>

<p>
</p>
<!--[eoform:assignment]-->


